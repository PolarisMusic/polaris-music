{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://polaris.music/schemas/releaseBundle.json",
  "title": "ReleaseBundle",
  "description": "Canonical schema for CREATE_RELEASE_BUNDLE event body",
  "type": "object",
  "required": ["release", "groups", "tracks", "tracklist"],
  "properties": {
    "release": {
      "type": "object",
      "description": "Release (album/EP/single) information",
      "required": ["name"],
      "properties": {
        "release_id": {
          "type": "string",
          "description": "Canonical external ID (e.g., Discogs release ID)"
        },
        "name": {
          "type": "string",
          "minLength": 1,
          "description": "Release name/title"
        },
        "alt_names": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Alternative names/titles"
        },
        "release_date": {
          "type": "string",
          "pattern": "^\\d{4}(-\\d{2}(-\\d{2})?)?$",
          "description": "Release date (YYYY, YYYY-MM, or YYYY-MM-DD)"
        },
        "format": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["vinyl", "cd", "cassette", "digital", "streaming"]
          },
          "description": "Release formats"
        },
        "country": {
          "type": "string",
          "description": "Country of release (ISO 3166-1 alpha-2)"
        },
        "catalog_number": {
          "type": "string",
          "description": "Label catalog number"
        },
        "liner_notes": {
          "type": "string",
          "description": "Liner notes text"
        },
        "trivia": {
          "type": "string",
          "description": "Trivia/fun facts"
        },
        "album_art": {
          "type": "string",
          "format": "uri",
          "description": "Album art image URL"
        },
        "master_id": {
          "type": "string",
          "description": "Master release ID for grouping"
        },
        "master_name": {
          "type": "string",
          "description": "Master release name"
        },
        "labels": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/label"
          },
          "description": "Labels that released this"
        },
        "guests": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/person"
          },
          "description": "Guest performers on the release"
        }
      }
    },
    "groups": {
      "type": "array",
      "minItems": 0,
      "items": {
        "$ref": "#/definitions/group"
      },
      "description": "Groups performing on this release"
    },
    "tracks": {
      "type": "array",
      "minItems": 1,
      "items": {
        "$ref": "#/definitions/track"
      },
      "description": "Tracks/recordings on this release"
    },
    "tracklist": {
      "type": "array",
      "minItems": 1,
      "items": {
        "$ref": "#/definitions/tracklistItem"
      },
      "description": "Ordered track listing"
    },
    "songs": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/song"
      },
      "description": "Song compositions (optional, can be inferred)"
    },
    "sources": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "type": { "type": "string" },
          "url": { "type": "string", "format": "uri" },
          "accessed_at": { "type": "string", "format": "date-time" }
        }
      },
      "description": "External source references"
    }
  },
  "definitions": {
    "person": {
      "type": "object",
      "required": ["name"],
      "properties": {
        "person_id": { "type": "string" },
        "name": { "type": "string" },
        "birth_name": { "type": "string" },
        "birth_date": { "type": "string" },
        "birth_city": { "$ref": "#/definitions/city" },
        "roles": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "group": {
      "type": "object",
      "required": ["name"],
      "properties": {
        "group_id": { "type": "string" },
        "name": { "type": "string" },
        "alt_names": {
          "type": "array",
          "items": { "type": "string" }
        },
        "bio": { "type": "string" },
        "formed_date": { "type": "string" },
        "disbanded_date": { "type": "string" },
        "origin_city": { "$ref": "#/definitions/city" },
        "members": {
          "type": "array",
          "items": {
            "allOf": [
              { "$ref": "#/definitions/person" },
              {
                "type": "object",
                "properties": {
                  "from_date": { "type": "string" },
                  "to_date": { "type": "string" },
                  "role": { "type": "string" }
                }
              }
            ]
          }
        }
      }
    },
    "track": {
      "type": "object",
      "required": ["title"],
      "properties": {
        "track_id": { "type": "string" },
        "title": { "type": "string" },
        "duration": { "type": "number" },
        "isrc": { "type": "string" },
        "performed_by": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Group IDs that performed this track"
        },
        "guests": {
          "type": "array",
          "items": {
            "allOf": [
              { "$ref": "#/definitions/person" },
              {
                "type": "object",
                "properties": {
                  "role": { "type": "string" }
                }
              }
            ]
          }
        },
        "recording_of": { "type": "string", "description": "Song ID this track records" },
        "samples": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Track IDs sampled in this track"
        }
      }
    },
    "tracklistItem": {
      "type": "object",
      "required": ["position", "track_title"],
      "properties": {
        "position": { "type": "string", "description": "Track position (A1, B2, 01, etc)" },
        "track_title": { "type": "string" },
        "track_id": { "type": "string" },
        "duration": { "type": "number" }
      }
    },
    "song": {
      "type": "object",
      "required": ["title"],
      "properties": {
        "song_id": { "type": "string" },
        "title": { "type": "string" },
        "alt_titles": {
          "type": "array",
          "items": { "type": "string" }
        },
        "writers": {
          "type": "array",
          "items": { "$ref": "#/definitions/person" }
        },
        "iswc": { "type": "string" }
      }
    },
    "label": {
      "type": "object",
      "required": ["name"],
      "properties": {
        "label_id": { "type": "string" },
        "name": { "type": "string" },
        "city": { "$ref": "#/definitions/city" }
      }
    },
    "city": {
      "type": "object",
      "required": ["name"],
      "properties": {
        "city_id": { "type": "string" },
        "name": { "type": "string" },
        "lat": { "type": "number" },
        "lon": { "type": "number" }
      }
    }
  }
}
